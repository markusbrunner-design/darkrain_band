http://www.script-test.de/anleitungen/sonstige_scripte/captcha/captcha_script_anlegen.html



Legen Sie als erstes ein Verzeichnis mit dem Namen "captcha" an. Erstellen Sie in diesem Verzeichnis eine Datei "captcha.php".

Quellcode der Datei captcha.php: 

<?php   
   session_start();   
   unset($_SESSION['captcha_spam']);   
  
   function randomString($len) {   
      srand(date("s"));   
      //Der String $possible enthält alle Zeichen, die verwendet werden sollen  
      $possible="ABCDEFGHJKLMNPRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";   
      $str="";   
      while(strlen($str)<$len) {   
        $str.=substr($possible,(rand()%(strlen($possible))),1);   
      }   
   return($str);   
   }   
  
   $text = randomString(5);  //Die Zahl bestimmt die Anzahl stellen  
   $_SESSION['captcha_spam'] = $text;  
           
   header('Content-type: image/png');   
   $img = ImageCreateFromPNG('captcha.PNG'); //Backgroundimage   
   $color = ImageColorAllocate($img, 0, 0, 0); //Farbe   
   $ttf = $_SERVER['DOCUMENT_ROOT']."/captcha/XFILES.TTF"; //Schriftart   
   $ttfsize = 25; //Schriftgrösse   
   $angle = rand(0,5);   
   $t_x = rand(5,30);   
   $t_y = 35;   
   imagettftext($img, $ttfsize, $angle, $t_x, $t_y, $color, $ttf, $text);   
   imagepng($img);   
   imagedestroy($img);   
?>

Beschreibung der Variablen

captcha.PNG - Dies ist die Hintergrundgrafik, auf der die Zeichen dargestellt werden. Sie können entweder mit einem Bildbearbeitungsprogramm ein eigenes Bild erstellen oder Sie benutzen dieses.

($img, 0, 0, 0) - Hier können Sie die Farbe einstellen, Standard ist schwarz (0,0,0), weiss (255,255,255).

"/captcha/XFILES.TTF" - Das ist die Schriftart, mit der die generierten Zeichen angezeigt werden sollen. Kopieren Sie die gewünschte Schriftart in das Unterverzeichnis "captcha". Die von uns verwendete Schriftart gibt es hier.

Schriftgröße - Hier können Sie die Schriftgröße der generierten Schrift ändern.



****************************************************************************************************

http://www.script-test.de/anleitungen/sonstige_scripte/captcha/captcha_script_einbinden.html


Captcha in Formular und Mailerscript einbinden
 

Einbinden in das Kontaktformular bzw. in das Gästebuch

Wenn Sie ein Gästebuch verwenden oder ein Kontaktformular, muss immer einmal das generierte Bilder angezeigt werden und natürlich auch das Eingabefeld.

Quellcode für das Anzeigefeld des Bildes:

<img src="captcha/captcha.php" border="0" title="Sicherheitscode">

Quellcode für das Eingabefeld:

<input type="text" name="sicherheitscode" size="5">

Sie können es natürlich auch in eine Tabelle einbinden, ein Beispiel in Form eines Kontaktformular sehen Sie unten:

<html><head><title>Captcha</title></head>
<body>
<form action=mailer.php method="POST">
<table>
<tr><td>Nachname</td><td><input type=text name=Nachname></td></tr>
<tr><td>Vorname</td><td><input type=text name=Vorname></td></tr>
<tr><td>Beruf</td><td><input type=text name=Beruf></td></tr>
<tr><td>Betreff</td><td><input type=text name=betr></td></tr>
<tr><td>E-Mail</td><td><input type=text name=mailaddi></td></tr>
<tr><td>Empf&auml;nger E-Mail-Adresse</td><td><input type=text name=empf></td></tr>

<tr>
<td><img src="/script_test/captcha.php" border="0" title="Sicherheitscode"></td>
<td><input type="text" name="sicherheitscode" size="5"></td>
</tr>

<tr><td colspan=2 align=middle><input type=submit value="abschicken"></td></tr>
</table>

</form>
</body>
</html>

Einbinden in das Mailerscript

Es muss nun noch geprüft werden, ob der eingegebene Code im Formular identisch ist ,mit dem was auf dem Bild angezeigt wird. Dies geschieht in dem Script, in dem die Aktion hinter dem Button "abschicken" bzw. "eintragen" steht.

Quelltext in Form eines Beispieles der mailer.php die das entsprechende Formular verarbeitet, den Code vergleicht und absendet.

<?
session_start();

if(isset($_SESSION['captcha_spam']) AND $_POST["sicherheitscode"] == $_SESSION['captcha_spam'])
{
unset($_SESSION['captcha_spam']);

$mail_empfaenger=$empf;
$mail_absender=$mailaddi;
$betreff=$betr;
$text="Mein Name ist $Vorname $Nachname, von Beruf bin ich $Beruf";
mail($mail_empfaenger, $betreff, $text,"from:$mail_absender");

echo "Die eMail wurde erfolgreich versendet";

}else
{
die ("Der Sicherheitscode ist falsch!");
}
?>